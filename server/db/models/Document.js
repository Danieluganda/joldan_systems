/**\n * Document Model\n * \n * Data access layer for document records\n * Feature 10: Document management\n */\n\nconst pool = require('../config/database');\n\nclass Document {\n  /**\n   * Create a new document\n   */\n  static async create({\n    entityType,\n    entityId,\n    documentType,\n    title,\n    fileUrl,\n    fileHash,\n    uploadedBy,\n    description,\n    version,\n  }) {\n    const query = `\n      INSERT INTO documents (entity_type, entity_id, document_type, title, file_url, file_hash, uploaded_by, description, version, created_at)\n      VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, NOW())\n      RETURNING *\n    `;\n    const result = await pool.query(query, [\n      entityType,\n      entityId,\n      documentType,\n      title,\n      fileUrl,\n      fileHash,\n      uploadedBy,\n      description,\n      version,\n    ]);\n    return result.rows[0];\n  }\n\n  /**\n   * Get document by ID\n   */\n  static async findById(id) {\n    const query = 'SELECT * FROM documents WHERE id = $1';\n    const result = await pool.query(query, [id]);\n    return result.rows[0];\n  }\n\n  /**\n   * Get all documents\n   */\n  static async getAll(filters = {}) {\n    let query = 'SELECT * FROM documents WHERE 1=1';\n    const values = [];\n    let paramCount = 1;\n\n    if (filters.entityType) {\n      query += ` AND entity_type = $${paramCount}`;\n      values.push(filters.entityType);\n      paramCount++;\n    }\n\n    if (filters.entityId) {\n      query += ` AND entity_id = $${paramCount}`;\n      values.push(filters.entityId);\n      paramCount++;\n    }\n\n    if (filters.documentType) {\n      query += ` AND document_type = $${paramCount}`;\n      values.push(filters.documentType);\n      paramCount++;\n    }\n\n    query += ' ORDER BY created_at DESC';\n    const result = await pool.query(query, values);\n    return result.rows;\n  }\n\n  /**\n   * Update document\n   */\n  static async update(id, updates) {\n    const keys = Object.keys(updates);\n    const values = Object.values(updates);\n    const setClauses = keys.map((key, i) => `${key} = $${i + 1}`).join(', ');\n    const query = `\n      UPDATE documents\n      SET ${setClauses}, updated_at = NOW()\n      WHERE id = $${keys.length + 1}\n      RETURNING *\n    `;\n    values.push(id);\n    const result = await pool.query(query, values);\n    return result.rows[0];\n  }\n\n  /**\n   * Delete document\n   */\n  static async delete(id) {\n    const query = 'DELETE FROM documents WHERE id = $1';\n    await pool.query(query, [id]);\n  }\n\n  /**\n   * Get documents by entity\n   */\n  static async getByEntity(entityType, entityId) {\n    const query = 'SELECT * FROM documents WHERE entity_type = $1 AND entity_id = $2 ORDER BY created_at DESC';\n    const result = await pool.query(query, [entityType, entityId]);\n    return result.rows;\n  }\n\n  /**\n   * Get document versions\n   */\n  static async getVersions(entityType, entityId, documentType) {\n    const query = `\n      SELECT * FROM documents \n      WHERE entity_type = $1 \n      AND entity_id = $2 \n      AND document_type = $3\n      ORDER BY version DESC\n    `;\n    const result = await pool.query(query, [entityType, entityId, documentType]);\n    return result.rows;\n  }\n}\n\nmodule.exports = Document;\n"
