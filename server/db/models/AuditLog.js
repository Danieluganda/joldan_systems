/**\n * AuditLog Model\n * \n * Data access layer for audit trail records\n * Feature 11: Audit trail logging\n */\n\nconst pool = require('../config/database');\n\nclass AuditLog {\n  /**\n   * Create a new audit log entry\n   */\n  static async create({\n    userId,\n    action,\n    entityType,\n    entityId,\n    oldValues,\n    newValues,\n    ipAddress,\n    description,\n  }) {\n    const query = `\n      INSERT INTO audit_logs (user_id, action, entity_type, entity_id, old_values, new_values, ip_address, description, created_at)\n      VALUES ($1, $2, $3, $4, $5, $6, $7, $8, NOW())\n      RETURNING *\n    `;\n    const result = await pool.query(query, [\n      userId,\n      action,\n      entityType,\n      entityId,\n      oldValues,\n      newValues,\n      ipAddress,\n      description,\n    ]);\n    return result.rows[0];\n  }\n\n  /**\n   * Get audit log by ID\n   */\n  static async findById(id) {\n    const query = 'SELECT * FROM audit_logs WHERE id = $1';\n    const result = await pool.query(query, [id]);\n    return result.rows[0];\n  }\n\n  /**\n   * Get all audit logs\n   */\n  static async getAll(filters = {}) {\n    let query = 'SELECT * FROM audit_logs WHERE 1=1';\n    const values = [];\n    let paramCount = 1;\n\n    if (filters.entityType) {\n      query += ` AND entity_type = $${paramCount}`;\n      values.push(filters.entityType);\n      paramCount++;\n    }\n\n    if (filters.entityId) {\n      query += ` AND entity_id = $${paramCount}`;\n      values.push(filters.entityId);\n      paramCount++;\n    }\n\n    if (filters.userId) {\n      query += ` AND user_id = $${paramCount}`;\n      values.push(filters.userId);\n      paramCount++;\n    }\n\n    if (filters.action) {\n      query += ` AND action = $${paramCount}`;\n      values.push(filters.action);\n      paramCount++;\n    }\n\n    if (filters.startDate) {\n      query += ` AND created_at >= $${paramCount}`;\n      values.push(filters.startDate);\n      paramCount++;\n    }\n\n    if (filters.endDate) {\n      query += ` AND created_at <= $${paramCount}`;\n      values.push(filters.endDate);\n      paramCount++;\n    }\n\n    query += ' ORDER BY created_at DESC';\n    const result = await pool.query(query, values);\n    return result.rows;\n  }\n\n  /**\n   * Get audit logs by entity\n   */\n  static async getByEntity(entityType, entityId) {\n    const query = `\n      SELECT * FROM audit_logs \n      WHERE entity_type = $1 \n      AND entity_id = $2\n      ORDER BY created_at DESC\n    `;\n    const result = await pool.query(query, [entityType, entityId]);\n    return result.rows;\n  }\n\n  /**\n   * Get audit logs by user\n   */\n  static async getByUser(userId) {\n    const query = 'SELECT * FROM audit_logs WHERE user_id = $1 ORDER BY created_at DESC';\n    const result = await pool.query(query, [userId]);\n    return result.rows;\n  }\n\n  /**\n   * Get audit logs by date range\n   */\n  static async getByDateRange(startDate, endDate) {\n    const query = `\n      SELECT * FROM audit_logs \n      WHERE created_at >= $1 \n      AND created_at <= $2\n      ORDER BY created_at DESC\n    `;\n    const result = await pool.query(query, [startDate, endDate]);\n    return result.rows;\n  }\n}\n\nmodule.module = AuditLog;\n"
